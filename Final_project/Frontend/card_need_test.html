
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>我的卡牌</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />
  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<link href='https://fonts.useso.com/css?family=Roboto:400,100,300,700,900' rel='stylesheet' type='text/css'>
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Superfish -->
	<link rel="stylesheet" href="css/superfish.css">

	<link rel="stylesheet" href="css/style.css">


	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	</head>
	<body>
		<div id="fh5co-wrapper">
		<div id="fh5co-page">
		<div id="fh5co-header">
			<header id="fh5co-header-section">
				<div class="container">
					<div class="nav-header">
						<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
						<h1 id="fh5co-logo"><a href="index.html">今日<span>方舟</span></a></h1>
						<!-- START #fh5co-menu-wrap -->
						<nav id="fh5co-menu-wrap" role="navigation">
							<ul class="sf-menu" id="fh5co-primary-menu">
								<li>
									<a href="index.html">首页</a>
								</li>
								<li>
									<a href="market.html" >市场</a>
									
								</li>
								<li>
									<a href="reverse.html">仲裁</a>
								</li>
								<li><a href="about.html">玩法</a></li>
								<li><a href="transaction.html">交易</a></li>
								<li><a href="account.html">用户</a></li>
							</ul>
						</nav>
					</div>
				</div>
			</header>		
		</div>
		<!-- end:fh5co-header -->
		<div class="fh5co-hero">
			<div class="fh5co-overlay"></div>
			<div class="fh5co-cover" data-stellar-background-ratio="0.5" style="background-image: url(images/home-image.jpg);">
				<div class="desc animate-box">
					<h3 class="section-title" style="font-size: 40px; text-align: center; margin-top: -130px;">我的卡牌信息</h3>
					<div class="pic_list_con" style="margin:0 auto;">
						<h3><span>我的卡组</span></h3>
						<ul class="clearfix">
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
							<li><a href=""><img src="images/sign_in.jpg" alt="商品图片"></a></li>
						</ul>
						
						<!-- <input type="button"  value="获取json" id='btn-get_card_info-Json'> -->
						<div id='dynamicImg' onload="addImage()">
								<ul class="imgClass">
									
								</ul>
						</div>
						选择卡序号：<input type="number" id="cardNo" name="NO" style=background:rgb(18,124,74) min="1" max="10" /> <br>
						欲出价格：  <input type="number" id="price" name="PRICE" style=background:rgb(3,183,189)  min="1" max="10" /> <br>
						<span><a class="btn btn-primary" href="" id="upMarket"
							style="background-color: #d4af7a;color:rgb(255,255,255)">上架</a>
							<a class="btn btn-primary" href="" id="downMarket"
							style="background-color: #d4af7a;color:rgb(255,255,255)">下架</a>
						</span>

					</div>
				</div>
			</div>
		</div>
		
		

	</div>
	<!-- END fh5co-page -->

	</div>
	<!-- END fh5co-wrapper -->


	<script type="text/javascript">

// 全局变量
		var cardsID = [];	// 卡片id，用于发上架、下架的post请求
		var cardsName = []; // 卡片名字
		var cardsLevel = [];// 卡片等级
		var isOnSale = [];  // 卡片是否正在出售（上架）
		var cardNum = 0;    // 用户的卡片数量
	// 加入图片
	// 第一种方法
		// 获取的是一个 如果要获取多个
		// document.querySelectorAll(selector)
		// document.querySelectorAll("#btn-get_card_info-Json").onclick = function () {
		// 	var ajax = new XMLHttpRequest();
	
		// 	ajax.open('get','./get_card_info');
	
		// 	ajax.send();
	
		// 	ajax.onreadystatechange = function () {
		// 		if (ajax.readyState==4&&ajax.status==200) {
		// 			// json 字符串 是字符串 所以我们可以 通过  responseText获取
		// 			console.log(ajax.responseText);
	
		// 			// 转化为 js对象
		// 			var jsObj = JSON.parse(ajax.responseText);
	
		// 			console.log(jsObj);
	
		// 			// 拼接ul s
		// 			var str = '';
	
		// 			str+='<ul>';
		// 			str+='<li>'+jsObj.name+'</li>';
		// 			str+='<li>'+jsObj.skill+'</li>';
		// 			str+='<li>'+jsObj.friend+'</li>';
		// 			str+='</ul>';
	
		// 			// 设置到界面上
	
		// 			document.body.innerHTML = str;
		// 		}
		// 	}
		// }

		// 页面加载完后自动调用
		window.onload= function (){
			addImage();
   			// bb();
		}

		// 加入图片
		// 第二种方法
		function addImage(){
			//定义变量sendData
			this.cardsID ={'card_id':[1,2,3]};   //  假设用户都有ID为1,2,3的卡片
			var imgNum=0;   //  这个用户的卡片张数
			var urlImg=[];   //  这个用户的卡片的url
			var i=0;
		// alert('here');

		// 请求当前用户拥有的卡片cardsId
		$.ajax({
				url: '/get_account_info',
				type:'post',
				dataType:'json',
				contentType:"application/json",
				async:true,//异步请求
				cache:false,
				// data:JSON.stringify(sendData),//没有要发的数据
				//执行成功的回调函数
				success:function(data) {
					// alert(data.info);
					var jsonData = JSON.parse(data);
					this.cardsID=jsonData.info.cardsId;  //  获取这个用户所有卡片的id
					// 获取卡片的张数
					 for(var aItem in jsonData){
						imgNum++;
					 }    
					 this.cardNum=imgNum;
				},
				//执行失败或错误的回调函数
				error:function(data) {
					alert("未能拿到用户的卡片id信息！");
				}
		});
		for (i = 0; i < imgNum; i++) { 
		// 请求图片url
		$.ajax({
				url: '/get_card_info',
				type:'post',
				dataType:'json',
				contentType:"application/json",
				async:true,//异步请求
				cache:false,
				data:JSON.stringify({"card_id":this.cardsID[i]}),//使用变量sendData
				//执行成功的回调函数
				success:function(data) {
					// alert(data.url);
					var jsonData = JSON.parse(data);
					urlImg[i]=jsonData.info.url;   
					this.cardsName[i]=jsonData.info.name;
					this.isOnSale[i]=jsonData.info.isOnSale;
					this.cardsLevel[i]=jsonData.info.level;
				},
				//执行失败或错误的回调函数
				error:function(data) {
					alert("没有成功拿到卡片的url！");
				}
		});
		}
		
		// 动态添加图片
		// 第一种方法   appendChild
		// 获取位置元素
		// var dynamicImg=document.getElementById('dynamicImg');
		// // 把图片一张张插入页面
		// for (i = 0; i < imgNum; i++) { 
		// 	var aImg=document.createElement('img');
		// 	var imgId= document.createTextNode(""+i+1);// 第几张图片，从1开始
		// 	aImg.src=urlImg[i];
		// 	aImg.style.marginLeft = "160px";
		// 	dynamicImg.appendChild(imgId);
		// 	dynamicImg.appendChild(aImg);
		// }

		// 第二种方法 动态加入图片
		var imgClass = document.getElementsByClassName("imgClass");
		var list="";
		for (i = 0; i < imgNum; i++) { 
			list += "<li><a href=\"\"><img src=\"" + urlImg[i] +"\" alt=\"商品图片\"></a></li>";
			list += "<div class=\"item\""+
						"<div class=\"imgContainer\" >"
							+"<img src=\"" +urlImg[i] + "\" alt=\"个人拥有的卡片图片\">"
						+"</div>"
						+"<div class=\"info\" >"
							+"<p class = \"cardInfo\" >"
								+"<span class=\"cardNo\">"
									+"卡序号："+i
								+"</span>"
								+"<span class=\"name\">"
									+"名字："+this.cardsName[i]
								+"</span>"
								+"<span class=\"level\">"
									+"等级："+this.cardsLevel[i]
								+"</span>"
								+"<span class=\"isOnSale\">"
									+"是否已上架："+this.isOnSale[i]
								+"</span>"
							+"</p>"
						+"</div>"
					+"</div>";
			if(i%4==0)
				list+="<br>";  // 换行
		}
		imgClass.innerHTML = list;
}

    var goSale = document.getElementById('upMarket');
    goSale.onclick = function(){
		// 上架
		var price =document.getElementById('price').value;
		var cardNo = document.getElementById('cardNo').value;
		var sendData={'card_id':this.cardsID[parseInt(cardNo)-1],'price':price};  // parseInt: get int from string
		$.ajax({
				url: '/push_card',
				type:'post',
				dataType:'json',
				contentType:"application/json",
				async:true,//异步请求
				cache:false,
				data:JSON.stringify(sendData),
				//执行成功的回调函数
				success:function(data) {
					// alert(data.info);
					var jsonData = JSON.parse(data);
					if(jsonData.status=="OK")
						alert("上架成功！");
				},
				//执行失败或错误的回调函数
				error:function(data) {
					alert("上架失败！");
				}
		});
	};
	// 下架
	var downSale = document.getElementById('downMarket');
    downSale.onclick = function(){
		$.ajax({
				url: '/pull_card',
				type:'post',
				dataType:'json',
				contentType:"application/json",
				async:true,//异步请求
				cache:false,
				data:JSON.stringify({"card_id":this.cardsID[i]}),
				//执行成功的回调函数
				success:function(data) {
					// alert(data.info);
					var jsonData = JSON.parse(data);
					if(jsonData.status=="OK")
						alert("下架成功！");
				},
				//执行失败或错误的回调函数
				error:function(data) {
					alert("下架失败！");
				}
		});


    };
    // goSale.click();  //模拟点击事件，页面刷新，出发点击事件

	</script> -->

	<!-- <script src="js/showUsercards.js"></script> -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Stellar -->
	<script src="js/jquery.stellar.min.js"></script>
	<!-- Superfish -->
	<script src="js/hoverIntent.js"></script>
	<script src="js/superfish.js"></script>

	<!-- Main JS (Do not remove) -->
	<script src="js/main.js"></script>

	</body>
</html>

