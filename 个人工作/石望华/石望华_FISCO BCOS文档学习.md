# FISCO BCOS 文档学习记录与总结

------

## 1.关键概念

###### From：<https://fisco-bcos-documentation.readthedocs.io/zh_CN/release-2.0/docs/tutorial/key_concepts.html>

* 区块链

  ​	采用多项技术交叉组合，维护管理chain of block这个数据结构，形成一个不可篡改的分布式账本的综合技术领域。

   	技术架构：

  * 分布式架构与分布式存储
  * 块链式数据结构
  * 点对点网络
  * 共识算法
  * 密码学算法
  * 博弈论
  * 智慧合约
  * 世界状态存储

* 账本

  ​	管理帐户、交易流水等数据，支持分类记账、对账、清结算等功能，账本基本内容有区块，交易，帐户，世界状态。

* 区块

  ​	按时间次序构建的数据结构，每个区块高度逐一递增，新区块都会引入前一个区块的hash信息，再用hash算法和本区块的数据生成唯一的数据指纹，从而形成环环相扣的块链状结构，即区块链。

  * 区块头
    * 区块高度
    * hash
    * 出块者签名
    * 状态树根
  * 区块体--交易数据列表、回执

* 交易

  ​	一段发往区块链系统的请求数据，用于：

  * 部署合约

  * 调用合约接口

  * 维护合约生命周期

  * 管理资产

  * 进行价值交换

    

    交易的基本数据结构：

  * 发送者

  * 接受者

  * 交易数据

    

    “写操作”交易过程：

    用户构建交易--用私钥给交易签名--发送到链上--多个节点的共识机制处理交易--执行智能合约代码--生成交易指定的状态数据--打包交易至区块--交易和状态数据一起落盘存储--确认交易--交易回执（receipt）

    用户可以使用交易hash检查交易回执，判定交易是否完成。

    “只读”调用：

    call方法调用，读取链上数据，节点收到后会根据请求的参数访问状态信息并返回，并不会将请求加入共识流程，也不会导致修改链上的数据。

* 账户

  * 帐户模型设计--账户代表着用户、智能合约的唯一性存在

  * 公私钥体系...

  * 一个智能合约被部署后，在链上就有了一个唯一的地址，也称为合约帐户

    智能合约运行过程：

    唯一地址--加载二进制代码--状态数据索引--访问世界状态存储数据--运行结果--数据写入世界状态存储--更新合约用户里状态数据索引

    智能合约被注销时，主要是更新合约帐户里的合约状态位，将其置为无效，一般不会直接清除该合约账户的实际数据。

* 世界状态

  ​	智能合约执行过程产生的状态数据，经过共识机制确认，分布式的保存在各节点上，数据全局一致，可验证难篡改，所以称为“世界状态”。

* 共识机制

  ​	协同这些松散耦合、互不信任的参与者达成信任关系，并保障一致性，持续性协作的过程，可以抽象为“共识”过程，所牵涉的算法和策略统称为共识机制。

* 节点

  ​	安装了区块链系统所需软硬件，加入到区块链网络里的计算机称为节点，节点的标识采用公私钥机制，生成一串唯一的NodeID。

  * 参与网络通信、逻辑运算、数据验证与保存
  * 对客户端提供交易处理和数据查询接口
  * **共识节点**参与整个共识过程，做为记账者打包区块、做为验证者验证区块以完成共识过程
  * **观察节点**不参与共识，同步数据，进行验证并保存，可以做为数据服务者提供服务
  * **轻节点**只同步区块头以及少量的交易和状态数据，为某一次在线交易或数据查询提供验证

* 共识算法

  * 工作量证明（Proof of Work）
  * 权益证明（Proof of Stake）
  * 委托权益证明（Delegated Proof of Stake）
  * 实用性拜占庭容错共识PBFT（Practical Byzantine Fault Tolerance，PBFT）
  * Raft
  * 将随机数发生器和上述几个共识算法进行有机组合
  * FISCO BCOS共识模块采用**插件化**的设计，可支持多种共识算法，当前包括PBFT和Raft

* 智能合约

  * 以数字形式定义的能自动执行条款的合约。

  * 功能：资产管理、规则定义、价值交换、全局配置、运维治理、权限管理。
  * 开发语言：solidity,C++,java,go,javascript,rust。

* 智能合约生命周期

  * 设计, 开发, 测试, 部署, 共识算法确认, 运行, 升级, 销毁。
  * 升级后的新版合约有一个新的地址和独立的存储空间，不覆盖旧的合约。新版合约可通过旧合约数据接口访问旧版本合约里保存的数据，或者通过数据迁移的方式将旧合约的数据迁移到新合约的存储里。
  * 最佳实践是设计执行流程的“行为合约”和保存数据的“数据合约”，将数据和合约解耦。
  * 销毁一个旧合约并不意味着清除合约的所有数据，只是将其状态置为“无效”，该合约则不可再被调用。

* 智能合约虚拟机

  * 虚拟机体系：运行数字智能合约，区块链系统必须具备的可编译、解析、执行计算机代码的编译器和执行器。
  * 虚拟机应具有沙盒特征，屏蔽类似随机数、系统时间、外部文件系统、网络等可能导致不确定性的因素，且可以抵抗恶意代码的侵入。
  * 当前流行的虚拟机机制：EVM、受控的Docker、WebAssembly。

* 图灵完备

  * 一种抽象计算模型
  * 李嘉图合约（The Ricardian Contract）  or  智能合约 
  * 停机问题

* 区块链类型

  * 公有链--所有人都可以随时随地参与甚至是匿名参与的链
  * 联盟链--多个主体达成一定的协议--加入联盟链的成员需要经过验证，一般是身份可知的
    * 正因为有准入机制，所以联盟链也通常被称为“许可链”。
    * 共识一般采用PBFT，网络规模相对可控
  * 私有链--一个主体（如一个机构或一个自然人）所有，私有化的管理和使用的链

* 性能指标

  * TPS（Transaction Per Second）
  * 确认时延：交易发送到区块链网络后，经过验证、运算和共识等一系列流程后，到被确认时所用的时间
  * 网络规模：在保证一定的TPS和确认时延前提下，能支持多少共识节点的协同工作

* 性能优化

  * 向上扩展：优化算法、硬件加速
  * 平行扩展：分片、分区

* 安全性

  * 系统：网络攻击、系统渗透、数据破坏和泄漏
  * 业务：越权操作、逻辑错误、系统稳定性造成的资产损失、隐私被侵害

* 准入机制

  身份可知、资质可信，技术可靠；链上的一切行为都可以追溯到机构和人。

* 权限控制

  * 合约部署、合约内数据访问、区块数据同步、系统参数访问和修改、节点启停

  * 基于角色的权限访问控制（Role-Based Access Control）
  * 运营管理者，交易操作员，应用开发者，运维管理者，监管方

* 隐私保护

  * 对共享的数据牵涉隐私的部分进行保护，避免运作过程泄漏隐私
  * 最小授权，明示同意的原则-对数据的收集、存储、应用、披露、删除、恢复全生命周期进行管理，建立日常管理和应急管理制度，高敏感业务场景设定监管角色，引入第三方检视和审计，从事先事中事后全环节进行管控。
  * 数据脱敏，业务隔离，系统物理隔离
  * 零知识证明、安全多方计算、环签名、群签名、盲签名

* 隔离

  * 物理隔离：只有共享数据的参与者在网络通信层互通，不参与共享数据的参与者在网络互相完全不能通信。
  * 逻辑隔离：参与者可以接收到和自己无关的数据，但数据本身带上权限控制或加密保护，使得没有授权或密钥的参与者不能访问和修改

* 联盟链治理

  理清各参与方的责权利，工作流程，构建顺畅的开发和运维体系，以及保障业务的合法合规，对包括安全性在内的问题能事先防范事后应急处理。

  * 各参与方共同组建联盟链委员会
  * 设定各种角色和分配任务

* 快速部署

  构建一个区块链系统的大致步骤：

  * 获取硬件资源
  * 环境配置
  * 获取区块链二进制可运行软件或者从源码进行编译
  * 区块链系统的配置（创世块配置、运行时参数配置，日志配置）
  * 多方互联配置（节点准入配置、端口发现、共识参与方列表）
  * 客户端和开发者工具配置

* 数据治理

  * 所有的数据都会保存在所有的参与节点上（轻节点之外）-->数据膨胀，容量紧张，安全问题
  * 裁剪迁移，平行扩容，分布式存储
  * 清结算周期
  * 分区

* 运维监控

  * 基础环境监控：CPU占比、系统内存占比和增长、磁盘IO情况、网络连接数和流量
  * 区块链系统监控：区块高度、交易量和虚拟机计算量，共识节点出块投票情况
  * 接口监控：接口调用计数、接口调用耗时情况、接口调用成功率

* 监管审计

  * 审计内控、责任鉴定和事件追溯
  * 穿透式监管